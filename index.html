<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calorie & Weight Tracker</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <link rel="stylesheet" href="styles.css?v=7" />
</head>
<body>
  <header class="row">
    <h1>Calorie & Weight Tracker</h1>
    <div class="auth">
      <button id="loginBtn">Login / Signup</button>
      <button id="logoutBtn">Logout</button>
    </div>
  </header>

  <div id="status" class="muted"></div>


  <div class="tabs hidden" id="tabs">
    <button class="tabbtn" id="tabDashboardBtn">Dashboard</button>
    <button class="tabbtn" id="tabSettingsBtn">Settings</button>
  </div>


  
  <main id="app" class="hidden">
    <div id="panelDashboard">
<section class="card">
      <h2>Daily Calorie Goal</h2>
      <div class="row">
        <input type="number" id="goalInput" placeholder="e.g. 2200" min="0" />
        <button id="saveGoalBtn">Save Goal</button>
      </div>
      <div id="goalDisplay" class="muted"></div>
    </section>

    <section class="card">
      <h2>Add Food (Photo of nutrition label)</h2>
      <div class="row">
        <div class="pill">Nutrition Label (accurate)</div>
      </div>
      <input id="photoInput" type="file" accept="image/*" capture="environment" />
      <div class="muted">Tip: get close, fill the frame with the Nutrition Facts panel.</div>

      <div style="height:10px"></div>
      <div class="row">
        <div class="pill">Plate Photo (estimate)</div>
      </div>
      <input id="plateInput" type="file" accept="image/*" capture="environment" />
      <div class="muted">Tip: capture the full plate in good light. Estimates are approximate.</div>

      <div style="height:14px"></div>
      <div class="row">
        <div class="pill">Manual Entry</div>
      </div>
      <div class="muted">Quick add calories/macros directly (no photo).</div>

      <div class="grid2">
        <div>
          <label>Calories (total)</label>
          <input id="manualCaloriesInput" type="number" min="0" step="1" placeholder="e.g. 450" />
        </div>
        <div>
          <label>Protein (g)</label>
          <input id="manualProteinInput" type="number" min="0" step="1" placeholder="optional" />
        </div>
        <div>
          <label>Carbs (g)</label>
          <input id="manualCarbsInput" type="number" min="0" step="1" placeholder="optional" />
        </div>
        <div>
          <label>Fat (g)</label>
          <input id="manualFatInput" type="number" min="0" step="1" placeholder="optional" />
        </div>
      </div>
      <label>Notes (optional)</label>
      <input id="manualNotesInput" type="text" placeholder="e.g. homemade chicken bowl" />

      <div class="row end" style="margin-top:10px">
        <button id="manualSaveBtn">Save Manual Entry</button>
      </div>
</section>


    <section class="card">
      <h2>Today</h2>
      <div class="row">
        <div><strong>Total calories:</strong> <span id="todayCalories">—</span></div>
        <div><strong>Goal:</strong> <span id="todayGoal">—</span></div>
      </div>
      <div class="progress">
        <div id="progressBar"></div>
      </div>
      <h3>Entries</h3>
      <ul id="entriesList"></ul>
    </section>

    <section class="card">
      <h2>Weight</h2>
      <div class="row">
        <input type="number" step="0.1" id="weightInput" placeholder="weight" />
        <button id="saveWeightBtn">Save Weight</button>
      </div>
      <div id="weightDisplay" class="muted"></div>
      <h3>Last 14 days</h3>
      <ul id="weightsList"></ul>
    </section>


    <section class="card">
      <h2>Weekly Trends (last 7 days)</h2>
      <div class="row">
        <div class="muted">Calories</div>
      </div>
      <canvas id="calChart" width="760" height="220"></canvas>
      <div class="row" style="margin-top:10px">
        <div class="muted">Weight</div>
      </div>
      <canvas id="wtChart" width="760" height="220"></canvas>
      <div class="muted">Tip: Weight chart uses gaps for missing days.</div>
    </section>

    <section class="card">
      <h2>Finish Day</h2>
      <button id="finishDayBtn">Get Score + Tips</button>
      <pre id="scoreOutput" class="pre"></pre>
    </section>

    <section class="card">
      <h2>Coach Chat</h2>
      <div class="row">
        <input id="chatInput" placeholder="Ask about today's log…" />
        <button id="sendChatBtn">Send</button>
      </div>
      <pre id="chatOutput" class="pre"></pre>
    </section>
  
    </div>

    <div id="panelSettings" class="hidden">

    <section class="card">
      <h2>Settings</h2>
      <div class="row">
        <label class="switch">
          <input type="checkbox" id="unitToggle" />
          <span class="slider"></span>
        </label>
        <div>
          <div><strong>Weight units:</strong> <span id="unitLabel">lbs</span></div>
          <div class="muted">Toggle to display weight in kilograms. Values are stored in lbs in the database.</div>
        </div>
      </div>
    </section>

    </div>
  </main>


  <script src="app.js?v=7"></script>

  <!-- Servings confirmation sheet -->
  <div id="sheetOverlay" class="overlay hidden"></div>
  <div id="servingsSheet" class="sheet hidden" role="dialog" aria-modal="true" aria-label="Confirm servings">
    <div class="sheetHeader">
      <div><strong>Confirm entry</strong></div>
      <button id="sheetCloseBtn" class="ghost">✕</button>
    </div>

    <div class="sheetBody">
      <label class="field">
        <div class="label">Servings eaten</div>
        <input type="number" id="servingsEatenInput" step="0.1" min="0" />
      </label>

      <label class="field">
        <div class="label">Calories per serving</div>
        <input type="number" id="calPerServingInput" step="0.1" min="0" />
      </label>

      <label class="field">
        <div class="label">Protein per serving (g)</div>
        <input type="number" id="proteinPerServingInput" step="0.1" min="0" />
      </label>

      <div class="computed">
        <div><strong>Total calories:</strong> <span id="totalCaloriesComputed">—</span></div>
        <div><strong>Total protein:</strong> <span id="totalProteinComputed">—</span></div>
      </div>

      <div class="row sheetActions">
        <button id="sheetCancelBtn">Cancel</button>
        <button id="sheetSaveBtn">Save Entry</button>
      </div>
      <div id="sheetError" class="muted" style="color:#b00020"></div>
    </div>
  </div>


  <!-- Plate estimate confirmation sheet -->
  <div id="estimateOverlay" class="estimate-overlay"></div>
  <div id="plateEstimateSheet" class="sheet hidden" role="dialog" aria-modal="true" aria-label="Confirm estimate">
    <div class="sheetHeader">
      <div><strong>Confirm estimate</strong> <span id="estimateBadge" class="badge">medium</span></div>
      <button id="estimateCloseBtn" class="ghost">✕</button>
    </div>

    <div class="sheetBody">
      <label class="field">
        <div class="label">Servings eaten</div>
        <input type="number" id="estimateServingsInput" step="0.1" min="0" />
      </label>

      <label class="field">
        <div class="label">Calories (total)</div>
        <input type="number" id="estimateCaloriesInput" step="1" min="0" />
      </label>

      <label class="field">
        <div class="label">Protein (g)</div>
        <input type="number" id="estimateProteinInput" step="1" min="0" />
      </label>

      <label class="field">
        <div class="label">Carbs (g)</div>
        <input type="number" id="estimateCarbsInput" step="1" min="0" />
      </label>

      <label class="field">
        <div class="label">Fat (g)</div>
        <input type="number" id="estimateFatInput" step="1" min="0" />
      </label>

      <div class="computed">
        <div class="label">Assumptions</div>
        <ul id="estimateAssumptions"></ul>
        <div id="estimateNotes" class="muted"></div>
      </div>

      <div class="row sheetActions">
        <button id="estimateCancelBtn">Cancel</button>
        <button id="estimateSaveBtn">Save Entry</button>
      </div>
      <div id="estimateError" class="muted" style="color:#b00020"></div>
    </div>
  </div>

</body>
</html>
