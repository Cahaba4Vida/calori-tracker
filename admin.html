<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Admin • Calorie &amp; Weight Tracker</title>
<link href="styles.css?v=18" rel="stylesheet"/>
</head>
<body>
<header class="row appHeader">
<div class="headerLeft"></div>
<div class="headerBrand">
<img alt="Aethon Calorie &amp; Weight Intelligence" class="bannerLight" src="assets/header_banner_light.jpg"/>
<img alt="Aethon Calorie &amp; Weight Intelligence" class="bannerDark" src="assets/header_banner_dark.jpg"/>
</div>
<a href="/">← Back to App</a>
</header>
<section class="card">
<h2>Admin Access</h2>
<label>Admin token (`ADMIN_DASH_TOKEN`)</label>
<input id="adminTokenInput" placeholder="Paste token" type="password"/>
<div class="row" style="margin-top:10px;">
<button id="authorizeBtn">Authorize</button>
<button id="clearTokenBtn">Clear Token</button>
</div>
<div class="muted" id="adminStatus"></div>
</section>
<div class="hidden" id="adminProtected">
<div class="toast hidden" id="adminToast"></div>
<nav class="tabs">
<button class="tabBtn" data-tab="users">Users</button>
<button class="tabBtn" data-tab="billing">Billing</button>
<button class="tabBtn" data-tab="insights">Insights</button>
<button class="tabBtn" data-tab="ops">Ops</button>
<button class="tabBtn" data-tab="todo">Todo</button>
<button class="tabBtn" data-tab="ambassadors">Ambassadors</button>
</nav>
<section class="tabPanel" id="tab_users">
<section class="card">
<h2>User Lookup</h2>
<label>Email, user_id, or device_id</label>
<div class="row">
<input id="userLookupInput" placeholder="user@example.com"/>
<button id="userLookupBtn">Lookup</button>
</div>
<div class="muted" id="userLookupStatus"></div>
<div class="userCard hidden" id="userCard"></div>
</section>
<section class="card">
<h2>Signed-up Users (Email Accounts)</h2>
<div class="row">
<button class="secondaryBtn" id="loadUsersBtn">Load Users</button>
<input id="usersFilter" placeholder="Filter by email…" style="max-width:320px;"/>
</div>
<div class="muted" id="usersStatus"></div>
<div class="tableWrap">
<table class="tbl" id="usersTable">
<thead>
<tr>
<th>Email</th>
<th>User ID</th>
<th>Created</th>
<th>Plan</th>
<th>Premium Pass</th>
<th>Goal</th>
<th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<div class="muted" style="margin-top:8px;">Edits apply to <code>user_profiles</code>. Deleting removes the user’s stored data (entries, weights, AI actions) from the database.</div>
</section>
<section class="card">
<h2>Access Overrides</h2>
<div class="grid2">
<div>
<label>Duration</label>
<select id="overrideDuration">
<option value="7">7 days</option>
<option value="30">30 days</option>
<option value="90">90 days</option>
<option value="unlimited">Unlimited</option>
</select>
</div>
<div>
<label>Note (required for Unlimited)</label>
<input id="overrideNote" placeholder="Reason / campaign"/>
</div>
</div>
<div class="row" style="margin-top:10px;">
<button id="grantOverrideBtn">Grant Premium</button>
<button class="secondaryBtn" id="grantTrialBtn">Grant Trial</button>
</div>
<div class="dangerZone" style="margin-top:14px;">
<div class="row">
<button class="dangerBtn" id="revokeOverrideBtn">Revoke Override</button>
</div>
<div class="muted" style="margin-top:6px;">Revoke affects admin pass overrides only. Active subscriptions remain premium.</div>
</div>
<div class="muted" id="overrideStatus"></div>
</section>
<section class="card">
<h2>Recent Admin Actions</h2>
<div class="row">
<button class="secondaryBtn" id="refreshAuditBtn">Refresh</button>
<button class="secondaryBtn" id="filterAuditBtn">Filter to selected user</button>
</div>
<div class="muted" id="auditStatus"></div>
<div class="auditList" id="auditList"></div>
</section>
</section>
<section class="tabPanel hidden" id="tab_billing"></section>
<section class="tabPanel hidden" id="tab_insights"></section>
<section class="tabPanel hidden" id="tab_ops"></section>
<section class="tabPanel hidden" id="tab_ambassadors">
<section class="card">
<h2>Ambassadors</h2>
<div class="muted" style="margin-bottom:10px;">Create ambassador accounts that can share custom monthly/yearly Stripe subscription links. Premium access is enforced strictly by Stripe subscription status.</div>
<div class="grid2">
<div>
<label>Ambassador email (Gmail)</label>
<input id="ambEmail" placeholder="ambassador@gmail.com"/>
</div>
<div>
<label>Display name (optional)</label>
<input id="ambName" placeholder="Name"/>
</div>
</div>
<div class="grid2" style="margin-top:10px;">
<div>
<label>Monthly price (USD)</label>
<input id="ambMonthlyUsd" min="1" placeholder="15" step="1" type="number"/>
</div>
<div>
<label>Yearly price (USD)</label>
<input id="ambYearlyUsd" min="1" placeholder="150" step="1" type="number"/>
</div>
</div>
<div style="margin-top:10px;">
<label>Notes (optional)</label>
<input id="ambNotes" placeholder="e.g., special promo"/>
</div>
<div class="row" style="margin-top:12px;">
<button id="ambCreateBtn">Create / Update</button>
<button class="secondaryBtn" id="ambRotateBtn">Rotate Token</button>
<button class="secondaryBtn" id="ambRefreshBtn">Refresh</button>
</div>
<div class="muted" id="ambStatus"></div>
<div class="muted" style="margin-top:10px;">Ambassador portal link: <code id="ambPortalLink">(select an ambassador)</code></div>
<div class="muted" style="margin-top:6px;">Token is shown only when created/rotated. Save it somewhere safe.</div>
</section>
<section class="card">
<h2>Existing Ambassadors</h2>
<div class="row">
<button class="secondaryBtn" id="ambLoadBtn">Load</button>
</div>
<div class="tableWrap">
<table class="tbl" id="ambTable">
<thead>
<tr>
<th>Email</th>
<th>Name</th>
<th>Monthly</th>
<th>Yearly</th>
<th>Total (first paid)</th><th>Active MRR</th><th>Created</th>
<th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</section>
</section>
<div class="hidden" id="legacyAdminCards">
<section class="card">
<h2>Growth Goals</h2>
<div><strong>Weekly active users goal:</strong> <span id="wauGoalTarget">500</span></div>
<div class="goalTrack"><div class="goalFill" id="wauGoalBar"></div></div>
<div class="muted" id="wauGoalLabel">0 / 500 (0%)</div>
<div style="margin-top:14px;"><strong>Paying users goal:</strong> <span id="paidGoalTarget">30</span></div>
<div class="goalTrack"><div class="goalFill paid" id="paidGoalBar"></div></div>
<div class="muted" id="paidGoalLabel">0 / 30 (0%)</div>
<div class="grid2" style="margin-top:14px;">
<div>
<label>Set weekly active users goal</label>
<input id="wauGoalInput" min="1" placeholder="500" step="1" type="number"/>
</div>
<div>
<label>Set paying users goal</label>
<input id="paidGoalInput" min="1" placeholder="30" step="1" type="number"/>
</div>
<div>
<label>Free food entries/day</label>
<input id="freeFoodLimitInput" min="1" placeholder="5" step="1" type="number"/>
</div>
<div>
<label>Free AI actions/day</label>
<input id="freeAiLimitInput" min="1" placeholder="3" step="1" type="number"/>
</div>
<div>
<label>Free history days</label>
<input id="freeHistoryDaysInput" min="1" placeholder="20" step="1" type="number"/>
</div>
<div>
<label>Monthly price (USD)</label>
<input id="monthlyPriceInput" min="1" placeholder="5" step="1" type="number"/>
</div>
<div>
<label>Yearly price (USD)</label>
<input id="yearlyPriceInput" min="1" placeholder="50" step="1" type="number"/>
</div>
<div>
<label>Manage subscription URL (optional)</label>
<input id="manageSubUrlInput" placeholder="https://..." type="text"/>
</div>
<div>
<label>Monthly upgrade URL (optional override)</label>
<input id="monthlyUpgradeUrlInput" placeholder="https://..." type="text"/>
</div>
<div>
<label>Yearly upgrade URL (optional override)</label>
<input id="yearlyUpgradeUrlInput" placeholder="https://..." type="text"/>
</div>
</div>
<div class="row" style="margin-top:10px;"><button id="saveGoalsBtn">Save Goals + Pricing</button></div>
<div class="muted" id="goalsStatus"></div>
</section>
<section class="card">
<h2>Premium Pass Override</h2>
<div class="muted">Grant or revoke premium access for a specific user without requiring payment.</div>
<label>User email or user_id</label>
<input id="passIdentifierInput" placeholder="user@example.com or netlify user id" type="text"/>
<label>Expires at (optional, ISO datetime)</label>
<div class="muted">Leave blank for <b>unlimited</b> premium access.</div>
<input id="passExpiresInput" placeholder="2026-12-31T23:59:59Z" type="text"/>
<label>Internal note (optional)</label>
<input id="passNoteInput" placeholder="why this pass was granted" type="text"/>
<label>Quick trial days</label>
<input id="trialDaysInput" max="90" min="1" placeholder="7" step="1" type="number"/>
<div class="row" style="margin-top:10px;">
<button id="grantPassBtn">Grant Pass</button>
<button id="grantUnlimitedBtn">Grant Unlimited Premium</button>
<button id="grantTrialBtn">Grant Trial Pass</button>
<button id="revokePassBtn">Revoke Pass</button>
</div>
<div class="muted" id="passStatus"></div>
</section>
<section class="card">
<h2>Billing Health</h2>
<div class="muted" id="billingHealthSummary">No billing health loaded yet.</div>
<div class="row" style="margin-top:10px;"><button id="reconcileSubsBtn">Reconcile Stripe Subscriptions</button></div>
<div class="muted" id="reconcileStatus"></div>
<pre class="pre" id="webhookEventsOut">No webhook events yet.</pre>
</section>
<section class="card">
<h2>App Statistics</h2>
<pre class="pre" id="statsOut">Load stats to view data.</pre>
</section>
<section class="card">
<h2>AI Insights</h2>
<div class="muted">Ask product questions (usage patterns, improvement ideas) using current app metrics.</div>
<label>Ask AI</label>
<textarea id="insightsQuestionInput" placeholder="What are people using this app for mostly and what improvements should we prioritize?" rows="3"></textarea>
<div class="row" style="margin-top:10px;"><button id="getInsightsBtn">Get AI Insights</button></div>
<pre class="pre" id="insightsOut">No insights yet.</pre>
<div class="muted" id="insightsStatus"></div>
</section>
<section class="card">
<h2>Feedback Form Broadcast (Mandatory)</h2>
<div class="muted">When active, app users must submit this form before using the app.</div>
<label>Form title</label>
<input id="campaignTitleInput" placeholder="Quick feedback request" type="text"/>
<label>Question</label>
<input id="campaignQuestionInput" placeholder="What should we improve?" type="text"/>
<label>Input placeholder</label>
<input id="campaignPlaceholderInput" placeholder="Share your feedback" type="text"/>
<label>Submit button label</label>
<input id="campaignSubmitLabelInput" placeholder="Submit feedback" type="text"/>
<div class="row" style="margin-top:10px;">
<button id="broadcastFeedbackBtn">Send Mandatory Feedback Form</button>
<button id="disableFeedbackBtn">Turn Off Feedback Lock</button>
</div>
<div class="muted" id="campaignStatus"></div>
</section>
</div>
<section class="tabPanel hidden" id="tab_todo">
<section class="card">
<h2>Todo</h2>
<div class="muted" style="margin-bottom:10px;">Private admin to-do list. Items are stored in the database and shared across admins using the same DB.</div>
<hr style="margin:14px 0;"/>
<h3 style="margin:0 0 6px 0;">Client update link</h3>
<div class="muted" style="margin-bottom:10px;">Set a link + short description that clients can see as a “Try updated version &gt;” button.</div>
<label>Updated version link</label>
<input id="updateLinkInput" placeholder="https://..." type="url"/>
<label style="margin-top:10px;">Update description</label>
<textarea id="updateDescInput" placeholder="What changed? (keep it short)" rows="3"></textarea>
<div class="row" style="margin-top:10px; gap:10px; align-items:center;">
<button id="updateSaveBtn">Save update</button>
<button class="btnMini" id="updateLoadBtn">Load current</button>
<div class="muted" id="updateSavedHint"></div>
</div>
<hr style="margin:14px 0;"/>
<label>New item</label>
<input id="todoTextInput" placeholder="e.g., Fix onboarding copy" type="text"/>
<div class="row" style="margin-top:10px; gap:10px; align-items:flex-end;">
<div style="flex:0 0 140px;">
<label>Priority</label>
<input id="todoPriorityInput" min="1" step="1" type="number" value="1"/>
<div class="muted" style="font-size:12px;">1 = highest</div>
</div>
<button id="todoAddBtn">Add</button>
<button class="btnMini" id="todoRefreshBtn">Refresh</button>
</div>
<div style="margin-top:14px;">
<div class="row" style="justify-content:space-between; align-items:center;">
<h3 style="margin:0;">Items</h3>
<div class="muted" id="todoCount"></div>
</div>
<div id="todoList" style="margin-top:10px;"></div>
</div>
</section>
</section>
</div>
<script src="admin.bundle.js?v=1"></script>
</body>
</html>
