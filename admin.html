<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin • Calorie & Weight Tracker</title>
  <link rel="stylesheet" href="styles.css?v=18" />
</head>
<body>
  <header class="row">
    <h1>Admin Dashboard</h1>
    <a href="/">← Back to App</a>
  </header>

  <section class="card">
    <h2>Admin Access</h2>
    <label>Admin token (`ADMIN_DASH_TOKEN`)</label>
    <input id="adminTokenInput" type="password" placeholder="Paste token" />
    <div class="row" style="margin-top:10px;">
      <button id="authorizeBtn">Authorize</button>
      <button id="clearTokenBtn">Clear Token</button>
    </div>
    <div id="adminStatus" class="muted"></div>
  </section>

  <div id="adminProtected" class="hidden">
    <section class="card">
      <h2>Growth Goals</h2>
      <div><strong>Weekly active users goal:</strong> <span id="wauGoalTarget">500</span></div>
      <div class="goalTrack"><div id="wauGoalBar" class="goalFill"></div></div>
      <div id="wauGoalLabel" class="muted">0 / 500 (0%)</div>

      <div style="margin-top:14px;"><strong>Paying users goal:</strong> <span id="paidGoalTarget">30</span></div>
      <div class="goalTrack"><div id="paidGoalBar" class="goalFill paid"></div></div>
      <div id="paidGoalLabel" class="muted">0 / 30 (0%)</div>

      <div style="margin-top:14px;" class="grid2">
        <div>
          <label>Set weekly active users goal</label>
          <input id="wauGoalInput" type="number" min="1" step="1" placeholder="500" />
        </div>
        <div>
          <label>Set paying users goal</label>
          <input id="paidGoalInput" type="number" min="1" step="1" placeholder="30" />
        </div>
        <div>
          <label>Free food entries/day</label>
          <input id="freeFoodLimitInput" type="number" min="1" step="1" placeholder="5" />
        </div>
        <div>
          <label>Free AI actions/day</label>
          <input id="freeAiLimitInput" type="number" min="1" step="1" placeholder="3" />
        </div>
        <div>
          <label>Free history days</label>
          <input id="freeHistoryDaysInput" type="number" min="1" step="1" placeholder="20" />
        </div>
        <div>
          <label>Monthly price (USD)</label>
          <input id="monthlyPriceInput" type="number" min="1" step="1" placeholder="5" />
        </div>
        <div>
          <label>Yearly price (USD)</label>
          <input id="yearlyPriceInput" type="number" min="1" step="1" placeholder="50" />
        </div>
        <div>
          <label>Manage subscription URL (optional)</label>
          <input id="manageSubUrlInput" type="text" placeholder="https://..." />
        </div>
        <div>
          <label>Monthly upgrade URL (optional override)</label>
          <input id="monthlyUpgradeUrlInput" type="text" placeholder="https://..." />
        </div>
        <div>
          <label>Yearly upgrade URL (optional override)</label>
          <input id="yearlyUpgradeUrlInput" type="text" placeholder="https://..." />
        </div>
      </div>
      <div class="row" style="margin-top:10px;"><button id="saveGoalsBtn">Save Goals + Pricing</button></div>
      <div id="goalsStatus" class="muted"></div>
    </section>

    <section class="card">
      <h2>Premium Pass Override</h2>
      <div class="muted">Grant or revoke premium access for a specific user without requiring payment.</div>
      <label>User email or user_id</label>
      <input id="passIdentifierInput" type="text" placeholder="user@example.com or netlify user id" />
      <label>Expires at (optional, ISO datetime)</label>
      <div class="muted">Leave blank for <b>unlimited</b> premium access.</div>
      <input id="passExpiresInput" type="text" placeholder="2026-12-31T23:59:59Z" />
      <label>Internal note (optional)</label>
      <input id="passNoteInput" type="text" placeholder="why this pass was granted" />
      <label>Quick trial days</label>
      <input id="trialDaysInput" type="number" min="1" max="90" step="1" placeholder="7" />
      <div class="row" style="margin-top:10px;">
        <button id="grantPassBtn">Grant Pass</button>
        <button id="grantUnlimitedBtn">Grant Unlimited Premium</button>
        <button id="grantTrialBtn">Grant Trial Pass</button>
        <button id="revokePassBtn">Revoke Pass</button>
      </div>
      <div id="passStatus" class="muted"></div>
    </section>


    <section class="card">
      <h2>Billing Health</h2>
      <div id="billingHealthSummary" class="muted">No billing health loaded yet.</div>
      <div class="row" style="margin-top:10px;"><button id="reconcileSubsBtn">Reconcile Stripe Subscriptions</button></div>
      <div id="reconcileStatus" class="muted"></div>
      <pre id="webhookEventsOut" class="pre">No webhook events yet.</pre>
    </section>

    <section class="card">
      <h2>App Statistics</h2>
      <pre id="statsOut" class="pre">Load stats to view data.</pre>
    </section>

    <section class="card">
      <h2>AI Insights</h2>
      <div class="muted">Ask product questions (usage patterns, improvement ideas) using current app metrics.</div>
      <label>Ask AI</label>
      <textarea id="insightsQuestionInput" rows="3" placeholder="What are people using this app for mostly and what improvements should we prioritize?"></textarea>
      <div class="row" style="margin-top:10px;"><button id="getInsightsBtn">Get AI Insights</button></div>
      <pre id="insightsOut" class="pre">No insights yet.</pre>
      <div id="insightsStatus" class="muted"></div>
    </section>

    <section class="card">
      <h2>Feedback Form Broadcast (Mandatory)</h2>
      <div class="muted">When active, app users must submit this form before using the app.</div>
      <label>Form title</label>
      <input id="campaignTitleInput" type="text" placeholder="Quick feedback request" />
      <label>Question</label>
      <input id="campaignQuestionInput" type="text" placeholder="What should we improve?" />
      <label>Input placeholder</label>
      <input id="campaignPlaceholderInput" type="text" placeholder="Share your feedback" />
      <label>Submit button label</label>
      <input id="campaignSubmitLabelInput" type="text" placeholder="Submit feedback" />
      <div class="row" style="margin-top:10px;">
        <button id="broadcastFeedbackBtn">Send Mandatory Feedback Form</button>
        <button id="disableFeedbackBtn">Turn Off Feedback Lock</button>
      </div>
      <div id="campaignStatus" class="muted"></div>
    </section>
  </div>

  <script src="admin-api.js?v=1"></script>
  <script src="admin-render.js?v=1"></script>
  <script src="admin.js?v=2"></script>
</body>
</html>
